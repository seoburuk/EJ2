# 03. ì‹œê°„í‘œ í˜ì´ì§€ êµ¬í˜„ ê°€ì´ë“œ

> ì´ ë¬¸ì„œëŠ” EJ2 í”„ë¡œì íŠ¸ì˜ **ì‹œê°„í‘œ(Timetable)** ê¸°ëŠ¥ì„ ì„¤ëª…í•©ë‹ˆë‹¤.
> ì‚¬ìš©ìê°€ í•™ê¸°ë³„ë¡œ ê³¼ëª©ì„ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œí•˜ê³ , ì‹œê°ì  ê·¸ë¦¬ë“œë¡œ í‘œì‹œí•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

---

## ëª©ì°¨

1. [ì „ì²´ íë¦„ ì´í•´í•˜ê¸°](#1-ì „ì²´-íë¦„-ì´í•´í•˜ê¸°)
2. [ë°±ì—”ë“œ êµ¬í˜„](#2-ë°±ì—”ë“œ-êµ¬í˜„)
   - 2.1 [Timetable ì—”í‹°í‹°](#21-timetable-ì—”í‹°í‹°)
   - 2.2 [TimetableCourse ì—”í‹°í‹°](#22-timetablecourse-ì—”í‹°í‹°)
   - 2.3 [DaySchedule ëª¨ë¸](#23-dayschedule-ëª¨ë¸)
   - 2.4 [TimetableService (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)](#24-timetableservice-ë¹„ì¦ˆë‹ˆìŠ¤-ë¡œì§)
   - 2.5 [TimetableController (API ì—”ë“œí¬ì¸íŠ¸)](#25-timetablecontroller-api-ì—”ë“œí¬ì¸íŠ¸)
3. [í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„](#3-í”„ë¡ íŠ¸ì—”ë“œ-êµ¬í˜„)
   - 3.1 [TimetablePage ì „ì²´ êµ¬ì¡° (TypeScript)](#31-timetablepage-ì „ì²´-êµ¬ì¡°-typescript)
   - 3.2 [ë¡œê·¸ì¸ ì²´í¬ ë¡œì§](#32-ë¡œê·¸ì¸-ì²´í¬-ë¡œì§)
   - 3.3 [ì‹œê°„í‘œ ê·¸ë¦¬ë“œ ë Œë”ë§](#33-ì‹œê°„í‘œ-ê·¸ë¦¬ë“œ-ë Œë”ë§)
   - 3.4 [ê³¼ëª© ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ](#34-ê³¼ëª©-ì¶”ê°€ìˆ˜ì •ì‚­ì œ)
   - 3.5 [í•˜ìœ„ í˜¸í™˜ì„± ì²˜ë¦¬](#35-í•˜ìœ„-í˜¸í™˜ì„±-ì²˜ë¦¬)
4. [ë°ì´í„° êµ¬ì¡° ì„¤ê³„](#4-ë°ì´í„°-êµ¬ì¡°-ì„¤ê³„)
5. [ê¶Œí•œ ê²€ì‚¬ íë¦„](#5-ê¶Œí•œ-ê²€ì‚¬-íë¦„)
6. [ìì£¼ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì™€ í•´ê²°ë²•](#6-ìì£¼-ë°œìƒí•˜ëŠ”-ì—ëŸ¬ì™€-í•´ê²°ë²•)

---

## 1. ì „ì²´ íë¦„ ì´í•´í•˜ê¸°

```
[ì‚¬ìš©ì] â†’ [í•™ê¸° ì„ íƒ (2026ë…„ ì „ê¸°)]
    â†’ [ì„œë²„ì— ì‹œê°„í‘œ ìš”ì²­] â†’ [ì—†ìœ¼ë©´ ìë™ ìƒì„±]
    â†’ [ì‹œê°„í‘œ + ê³¼ëª© ëª©ë¡ ë°˜í™˜]
    â†’ [ê·¸ë¦¬ë“œì— ì‹œê°ì ìœ¼ë¡œ í‘œì‹œ]

[ë¹ˆ ì¹¸ í´ë¦­] â†’ [ê³¼ëª© ì¶”ê°€ ëª¨ë‹¬] â†’ [ì €ì¥] â†’ [ê·¸ë¦¬ë“œ ê°±ì‹ ]
[ê³¼ëª© í´ë¦­] â†’ [ê³¼ëª© ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬] â†’ [ì²˜ë¦¬] â†’ [ê·¸ë¦¬ë“œ ê°±ì‹ ]
```

### í•µì‹¬ ê°œë…

| ê°œë… | ì„¤ëª… |
|------|------|
| **Timetable** | ì‹œê°„í‘œ ì»¨í…Œì´ë„ˆ. ì‚¬ìš©ìë‹¹ í•™ê¸°ë³„ë¡œ 1ê°œì”© |
| **TimetableCourse** | ì‹œê°„í‘œ ì•ˆì˜ ê°œë³„ ê³¼ëª© |
| **DaySchedule** | ê³¼ëª©ì˜ ìš”ì¼ë³„ ì‹œê°„ ì •ë³´ (ì›”ìš”ì¼ 1~2êµì‹œ, ìˆ˜ìš”ì¼ 3~4êµì‹œ ë“±) |
| **ì‹œê°„ ì¶©ëŒ ê²€ì‚¬** | ê°™ì€ ì‹œê°„ëŒ€ì— ë‘ ê³¼ëª©ì´ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ê²€ì¦ |
| **ì†Œìœ ì ê²€ì¦** | ìì‹ ì˜ ì‹œê°„í‘œë§Œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥ |

---

## 2. ë°±ì—”ë“œ êµ¬í˜„

### 2.1 Timetable ì—”í‹°í‹°

> **íŒŒì¼ ìœ„ì¹˜**: `backend/src/main/java/com/ej2/model/Timetable.java`

```java
@Entity
@Table(name = "timetables")
public class Timetable {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long timetableId;    // ì‹œê°„í‘œ PK

    @Column(nullable = false)
    private Long userId;         // ì‹œê°„í‘œ ì†Œìœ ì

    @Column(nullable = false)
    private Integer year;        // ë…„ë„ (2024, 2025, 2026)

    @Column(nullable = false)
    private String semester;     // í•™ê¸° ("spring", "fall")

    private String name;         // ì‹œê°„í‘œ ì´ë¦„

    @OneToMany(mappedBy = "timetable", cascade = CascadeType.ALL)
    private List<TimetableCourse> courses;  // ì´ ì‹œê°„í‘œì˜ ê³¼ëª©ë“¤
}
```

#### í…Œì´ë¸” ê´€ê³„ë„

```
timetables (ì‹œê°„í‘œ)           timetable_courses (ê³¼ëª©)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ timetableId  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ timetableId (FK)  â”‚
â”‚ userId       â”‚    1:N     â”‚ courseId           â”‚
â”‚ year         â”‚            â”‚ courseName         â”‚
â”‚ semester     â”‚            â”‚ dayOfWeek          â”‚
â”‚ name         â”‚            â”‚ periodStart        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ periodEnd          â”‚
                            â”‚ credits            â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì‚¬ìš©ì 1ëª… â†’ ì—¬ëŸ¬ ê°œì˜ ì‹œê°„í‘œ (í•™ê¸°ë³„)
ì‹œê°„í‘œ 1ê°œ â†’ ì—¬ëŸ¬ ê°œì˜ ê³¼ëª©
```

### 2.2 TimetableCourse ì—”í‹°í‹°

> **íŒŒì¼ ìœ„ì¹˜**: `backend/src/main/java/com/ej2/model/TimetableCourse.java`

```java
@Entity
@Table(name = "timetable_courses")
public class TimetableCourse {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long courseId;           // ê³¼ëª© PK

    @ManyToOne
    @JoinColumn(name = "timetable_id")
    private Timetable timetable;     // ì†Œì† ì‹œê°„í‘œ

    private String courseName;       // ê³¼ëª©ëª… (ì˜ˆ: "ë°ì´í„°ë² ì´ìŠ¤")
    private String professorName;    // êµìˆ˜ëª…
    private String classroom;        // ê°•ì˜ì‹¤ (ì˜ˆ: "ê³µí•™ê´€ 301í˜¸")

    private Integer dayOfWeek;       // ìš”ì¼ (1=ì›” ~ 5=ê¸ˆ) [ë ˆê±°ì‹œ]
    private Integer periodStart;     // ì‹œì‘ êµì‹œ [ë ˆê±°ì‹œ]
    private Integer periodEnd;       // ì¢…ë£Œ êµì‹œ [ë ˆê±°ì‹œ]

    @Convert(converter = IntegerListConverter.class)
    private List<Integer> daysOfWeek;     // ìš”ì¼ ëª©ë¡ [ë ˆê±°ì‹œ í™•ì¥]

    @Convert(converter = DayScheduleListConverter.class)
    private List<DaySchedule> daySchedules;  // ìš”ì¼ë³„ ìŠ¤ì¼€ì¤„ [ìµœì‹  êµ¬ì¡°]

    private Double credits;          // í•™ì  (ê¸°ë³¸: 3.0)
    private String colorCode;        // í‘œì‹œ ìƒ‰ìƒ (ì˜ˆ: "#3b82f6")
}
```

#### ë°ì´í„° êµ¬ì¡° ì§„í™” ê³¼ì •

```
[1ì„¸ëŒ€] dayOfWeek + periodStart + periodEnd
â†’ "ì›”ìš”ì¼ 1~2êµì‹œ" í•˜ë‚˜ë§Œ í‘œí˜„ ê°€ëŠ¥

[2ì„¸ëŒ€] daysOfWeek (ë¦¬ìŠ¤íŠ¸)
â†’ "ì›”,ìˆ˜ 1~2êµì‹œ" ê°™ì€ ìš”ì¼ ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥
â†’ í•˜ì§€ë§Œ ëª¨ë“  ìš”ì¼ì˜ ì‹œê°„ì´ ê°™ì•„ì•¼ í•¨

[3ì„¸ëŒ€] daySchedules (í˜„ì¬)
â†’ "ì›”ìš”ì¼ 1~2êµì‹œ, ìˆ˜ìš”ì¼ 3~4êµì‹œ" ì²˜ëŸ¼ ìš”ì¼ë§ˆë‹¤ ë‹¤ë¥¸ ì‹œê°„ ê°€ëŠ¥
â†’ ê°€ì¥ ìœ ì—°í•œ êµ¬ì¡°
```

### 2.3 DaySchedule ëª¨ë¸

```java
public class DaySchedule {
    private Integer day;          // ìš”ì¼ (1=ì›”, 2=í™”, ...)
    private Integer periodStart;  // ì‹œì‘ êµì‹œ
    private Integer periodEnd;    // ì¢…ë£Œ êµì‹œ
}
```

#### ì‹¤ì œ ë°ì´í„° ì˜ˆì‹œ

```json
// "í”„ë¡œê·¸ë˜ë°" ê³¼ëª©: ì›”ìš”ì¼ 1~2êµì‹œ, ìˆ˜ìš”ì¼ 3~4êµì‹œ
{
  "courseName": "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°",
  "daySchedules": [
    { "day": 1, "periodStart": 1, "periodEnd": 2 },
    { "day": 3, "periodStart": 3, "periodEnd": 4 }
  ]
}
```

#### JPA Converterë€?

```java
@Convert(converter = DayScheduleListConverter.class)
private List<DaySchedule> daySchedules;
```

- DBì—ëŠ” JSON ë¬¸ìì—´ë¡œ ì €ì¥: `'[{"day":1,"periodStart":1,"periodEnd":2}]'`
- Javaì—ì„œëŠ” `List<DaySchedule>` ê°ì²´ë¡œ ì‚¬ìš©
- Converterê°€ ìë™ìœ¼ë¡œ ë³€í™˜: JSON â†” Java ê°ì²´

```
DB ì €ì¥ ì‹œ:  List<DaySchedule> â†’ "[{...}]" (JSON ë¬¸ìì—´)
DB ì¡°íšŒ ì‹œ:  "[{...}]" (JSON ë¬¸ìì—´) â†’ List<DaySchedule>
```

---

### 2.4 TimetableService (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)

> **íŒŒì¼ ìœ„ì¹˜**: `backend/src/main/java/com/ej2/service/TimetableService.java`

#### ì‹œê°„í‘œ ì¡°íšŒ (ì—†ìœ¼ë©´ ìë™ ìƒì„±)

```java
public Map<String, Object> getTimetableWithCourses(Long userId, Integer year, String semester) {
    // 1ë‹¨ê³„: ì‚¬ìš©ìì˜ í•™ê¸°ë³„ ì‹œê°„í‘œ ì¡°íšŒ
    Timetable timetable = timetableRepository
        .findByUserIdAndYearAndSemester(userId, year, semester);

    // 2ë‹¨ê³„: ì‹œê°„í‘œê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
    if (timetable == null) {
        timetable = new Timetable(userId, year, semester);
        timetable = timetableRepository.save(timetable);
    }

    // 3ë‹¨ê³„: í•´ë‹¹ ì‹œê°„í‘œì˜ ê³¼ëª© ëª©ë¡ ì¡°íšŒ
    List<TimetableCourse> courses = courseRepository
        .findByTimetableId(timetable.getTimetableId());

    // 4ë‹¨ê³„: ì‹œê°„í‘œ + ê³¼ëª©ì„ í•¨ê»˜ ë°˜í™˜
    Map<String, Object> result = new HashMap<>();
    result.put("timetable", timetable);
    result.put("courses", courses);
    return result;
}
```

**"ì—†ìœ¼ë©´ ìë™ ìƒì„±" íŒ¨í„´**: ì‚¬ìš©ìê°€ ì²˜ìŒ ì‹œê°„í‘œ í˜ì´ì§€ì— ì ‘ì†í•˜ë©´, í•´ë‹¹ í•™ê¸°ì˜ ì‹œê°„í‘œê°€ ì•„ì§ DBì— ì—†ìŠµë‹ˆë‹¤. ë§¤ë²ˆ "ì‹œê°„í‘œ ìƒì„±" ë²„íŠ¼ì„ ëˆ„ë¥´ê²Œ í•˜ëŠ” ëŒ€ì‹ , ìë™ìœ¼ë¡œ ë¹ˆ ì‹œê°„í‘œë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì´ ë” ì¢‹ì€ UXì…ë‹ˆë‹¤.

#### ì‹œê°„ ì¶©ëŒ ê²€ì‚¬

```java
public TimetableCourse addCourse(Long timetableId, TimetableCourse courseData) {
    // ì‹œê°„í‘œ ì¡´ì¬ í™•ì¸
    Timetable timetable = timetableRepository.findById(timetableId);
    if (timetable == null) {
        throw new RuntimeException("æ™‚é–“å‰²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
    }

    // â˜… ì‹œê°„ ì¶©ëŒ ê²€ì‚¬
    boolean hasConflict = courseRepository.hasTimeConflict(
        timetableId,
        courseData.getDayOfWeek(),    // ìš”ì¼
        courseData.getPeriodStart(),  // ì‹œì‘ êµì‹œ
        courseData.getPeriodEnd(),    // ì¢…ë£Œ êµì‹œ
        null                          // ì œì™¸í•  ê³¼ëª© ID (ì‹ ê·œì´ë¯€ë¡œ null)
    );

    if (hasConflict) {
        throw new RuntimeException("ã“ã®æ™‚é–“ã«ã¯æ—¢ã«ç§‘ç›®ãŒã‚ã‚Šã¾ã™");
    }

    courseData.setTimetable(timetable);
    return courseRepository.save(courseData);
}
```

#### ì¶©ëŒ ê²€ì‚¬ ì˜ˆì‹œ

```
ê¸°ì¡´ ê³¼ëª©: ì›”ìš”ì¼ 1~3êµì‹œ (ë°ì´í„°ë² ì´ìŠ¤)

ì¶”ê°€ ì‹œë„: ì›”ìš”ì¼ 2~4êµì‹œ (í”„ë¡œê·¸ë˜ë°)
â†’ 2, 3êµì‹œê°€ ê²¹ì¹¨ â†’ "ã“ã®æ™‚é–“ã«ã¯æ—¢ã«ç§‘ç›®ãŒã‚ã‚Šã¾ã™"

ì¶”ê°€ ì‹œë„: ì›”ìš”ì¼ 4~5êµì‹œ (ë„¤íŠ¸ì›Œí¬)
â†’ ê²¹ì¹˜ëŠ” ì‹œê°„ ì—†ìŒ â†’ ì¶”ê°€ ì„±ê³µ!

ì¶”ê°€ ì‹œë„: í™”ìš”ì¼ 1~3êµì‹œ (ì•Œê³ ë¦¬ì¦˜)
â†’ ìš”ì¼ì´ ë‹¤ë¥´ë¯€ë¡œ ê²¹ì¹˜ì§€ ì•ŠìŒ â†’ ì¶”ê°€ ì„±ê³µ!
```

#### ì†Œìœ ì ê²€ì¦

```java
// ì‹œê°„í‘œì˜ ì†Œìœ ìì¸ì§€ í™•ì¸
public boolean isOwner(Long timetableId, Long userId) {
    Timetable timetable = timetableRepository.findById(timetableId);
    return timetable != null && timetable.getUserId().equals(userId);
}

// ê³¼ëª©ì˜ ì†Œìœ ìì¸ì§€ í™•ì¸ (ê³¼ëª© â†’ ì‹œê°„í‘œ â†’ ì‚¬ìš©ì)
public boolean isCourseOwner(Long courseId, Long userId) {
    TimetableCourse course = courseRepository.findById(courseId);
    if (course == null || course.getTimetable() == null) {
        return false;
    }
    return course.getTimetable().getUserId().equals(userId);
}
```

**ì™œ ê³¼ëª©ì—ë„ ì†Œìœ ì ê²€ì¦ì´ í•„ìš”í•œê°€?**
```
ì‚¬ìš©ì Aì˜ ì‹œê°„í‘œ â†’ ê³¼ëª© ID: 10
ì‚¬ìš©ì Bê°€ PUT /api/timetable/course/10 ìš”ì²­

ì†Œìœ ì ê²€ì¦ì´ ì—†ë‹¤ë©´:
â†’ Bê°€ Aì˜ ê³¼ëª©ì„ ìˆ˜ì •í•  ìˆ˜ ìˆìŒ! (ë³´ì•ˆ ì·¨ì•½ì )

ì†Œìœ ì ê²€ì¦ì´ ìˆìœ¼ë©´:
â†’ course(10) â†’ timetable â†’ userIdê°€ A â†’ Bì™€ ë¶ˆì¼ì¹˜ â†’ 403 Forbidden
```

---

### 2.5 TimetableController (API ì—”ë“œí¬ì¸íŠ¸)

> **íŒŒì¼ ìœ„ì¹˜**: `backend/src/main/java/com/ej2/controller/TimetableController.java`

#### API ëª©ë¡

| ë©”ì„œë“œ | URL | ì„¤ëª… |
|--------|-----|------|
| GET | `/api/timetable?year=2026&semester=spring` | ì‹œê°„í‘œ + ê³¼ëª© ì¡°íšŒ |
| POST | `/api/timetable/course` | ê³¼ëª© ì¶”ê°€ |
| PUT | `/api/timetable/course/{courseId}` | ê³¼ëª© ìˆ˜ì • |
| DELETE | `/api/timetable/course/{courseId}` | ê³¼ëª© ì‚­ì œ |

#### Map<String, Object>ìœ¼ë¡œ ë°ì´í„° ë°›ëŠ” ì´ìœ 

```java
@PostMapping("/course")
public ResponseEntity<?> addCourse(
    @RequestBody Map<String, Object> requestData,  // â† DTOê°€ ì•„ë‹Œ Map ì‚¬ìš©
    HttpSession session
) { ... }
```

**ì¼ë°˜ì ì¸ ë°©ì‹ (DTO ì‚¬ìš©)**:
```java
@RequestBody CourseRequest request  // ê³ ì •ëœ í•„ë“œë§Œ ë°›ìŒ
```

**Map ë°©ì‹ì˜ ì¥ì **:
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë³´ë‚´ëŠ” ë°ì´í„° í˜•íƒœê°€ ìœ ë™ì ì¼ ë•Œ ìœ ì—°í•˜ê²Œ ëŒ€ì‘
- `daySchedules`(ìƒˆ í˜•ì‹)ì™€ `dayOfWeek`(êµ¬ í˜•ì‹) ëª¨ë‘ ì²˜ë¦¬ ê°€ëŠ¥
- í•„ë“œê°€ ì¶”ê°€ë˜ì–´ë„ ë°±ì—”ë“œ DTOë¥¼ ìˆ˜ì •í•  í•„ìš” ì—†ìŒ

**Map ë°©ì‹ì˜ ë‹¨ì **:
- íƒ€ì… ì•ˆì „ì„±ì´ ì—†ìŒ (ëŸ°íƒ€ì„ ì—ëŸ¬ ê°€ëŠ¥)
- ì½”ë“œê°€ ì§€ì €ë¶„í•´ì§ (`Integer.valueOf(requestData.get("periodStart").toString())`)
- IDE ìë™ì™„ì„± ë¶ˆê°€

#### daySchedules ì¶”ì¶œ ë¡œì§ (ìƒˆ êµ¬ì¡° ìš°ì„ )

```java
// daySchedulesê°€ ìˆìœ¼ë©´ ìƒˆ êµ¬ì¡° ì‚¬ìš©
Object daySchedulesObj = requestData.get("daySchedules");
if (daySchedulesObj != null && daySchedulesObj instanceof List) {
    List<?> schedulesList = (List<?>) daySchedulesObj;
    List<DaySchedule> daySchedules = new ArrayList<>();
    List<Integer> daysOfWeek = new ArrayList<>();

    for (Object item : schedulesList) {
        if (item instanceof Map) {
            Map<?, ?> scheduleMap = (Map<?, ?>) item;
            Integer day = Integer.valueOf(scheduleMap.get("day").toString());
            Integer periodStart = Integer.valueOf(scheduleMap.get("periodStart").toString());
            Integer periodEnd = Integer.valueOf(scheduleMap.get("periodEnd").toString());

            daySchedules.add(new DaySchedule(day, periodStart, periodEnd));
            daysOfWeek.add(day);
        }
    }
    course.setDaySchedules(daySchedules);
    course.setDaysOfWeek(daysOfWeek);            // í•˜ìœ„ í˜¸í™˜ì„±
    course.setDayOfWeek(daysOfWeek.get(0));      // í•˜ìœ„ í˜¸í™˜ì„±
    course.setPeriodStart(daySchedules.get(0).getPeriodStart()); // í•˜ìœ„ í˜¸í™˜ì„±
    course.setPeriodEnd(daySchedules.get(0).getPeriodEnd());     // í•˜ìœ„ í˜¸í™˜ì„±
} else {
    // êµ¬ í˜•ì‹ ì²˜ë¦¬ (dayOfWeek + periodStart + periodEnd)
}
```

---

## 3. í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„

### 3.1 TimetablePage ì „ì²´ êµ¬ì¡° (TypeScript)

> **íŒŒì¼ ìœ„ì¹˜**: `frontend/src/pages/Timetable/TimetablePage.tsx`

ì´ íŒŒì¼ì€ í”„ë¡œì íŠ¸ì—ì„œ ìœ ì¼í•œ **TypeScript** íŒŒì¼ì…ë‹ˆë‹¤.

```typescript
// TypeScript ì¸í„°í˜ì´ìŠ¤ ì •ì˜
interface User {
  id: number;
  name: string;
  username: string;
  email: string;
}

const TimetablePage: React.FC = () => {
  // ìƒíƒœ ê´€ë¦¬
  const [timetable, setTimetable] = useState<Timetable | null>(null);
  const [courses, setCourses] = useState<TimetableCourse[]>([]);
  const [selectedSemester, setSelectedSemester] = useState('spring');
  const [selectedYear, setSelectedYear] = useState(2026);
  const [currentUser, setCurrentUser] = useState<User | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [selectedSlot, setSelectedSlot] = useState<{day: number, period: number} | null>(null);
  const [editingCourse, setEditingCourse] = useState<TimetableCourse | null>(null);
};
```

#### TypeScript vs JavaScript

```typescript
// TypeScript - íƒ€ì…ì´ ìˆì–´ì„œ ì•ˆì „
const [courses, setCourses] = useState<TimetableCourse[]>([]);
// â†’ coursesëŠ” ë°˜ë“œì‹œ TimetableCourse ë°°ì—´
// â†’ setCourses(123) ê°™ì€ ì˜ëª»ëœ ì‚¬ìš©ì„ ì»´íŒŒì¼ ì—ëŸ¬ë¡œ ì¡ì•„ì¤Œ

// JavaScript - íƒ€ì…ì´ ì—†ì–´ì„œ ììœ ë¡­ì§€ë§Œ ìœ„í—˜
const [courses, setCourses] = useState([]);
// â†’ coursesì— ì–´ë–¤ ê°’ì´ë“  ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŒ
// â†’ ëŸ°íƒ€ì„ì—ì„œì•¼ ì—ëŸ¬ ë°œìƒ
```

---

### 3.2 ë¡œê·¸ì¸ ì²´í¬ ë¡œì§

```typescript
const checkLogin = async () => {
    // 1ë‹¨ê³„: localStorage í™•ì¸ (ë¹ ë¥¸ ì²´í¬)
    const storedUser = localStorage.getItem('user');
    if (!storedUser) {
        navigate('/login', {
            state: { from: '/timetable', message: 'ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚' }
        });
        return;
    }

    // 2ë‹¨ê³„: ì„œë²„ ì„¸ì…˜ í™•ì¸ (í™•ì‹¤í•œ ì²´í¬)
    try {
        await axios.get('/api/auth/me', { withCredentials: true });
        setCurrentUser(JSON.parse(storedUser));
    } catch (error: any) {
        // ì„¸ì…˜ ë§Œë£Œ â†’ localStorage ì •ë¦¬ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
        localStorage.removeItem('user');
        navigate('/login', {
            state: { from: '/timetable', message: 'å†åº¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚' }
        });
    }
};
```

#### ì™œ 2ë‹¨ê³„ ë¡œê·¸ì¸ ì²´í¬ì¸ê°€?

```
ì‹œë‚˜ë¦¬ì˜¤: ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì €ë¥¼ ë‹«ê³  ë‹¤ìŒ ë‚  ë‹¤ì‹œ ì ‘ì†

1ë‹¨ê³„ë§Œ ìˆìœ¼ë©´:
localStorageì— user ìˆìŒ â†’ "ë¡œê·¸ì¸ ìƒíƒœ" â†’ API í˜¸ì¶œ â†’ ì„¸ì…˜ ë§Œë£Œ â†’ 401 ì—ëŸ¬!
â†’ ì‹œê°„í‘œ í˜ì´ì§€ì— ë“¤ì–´ì™”ëŠ”ë° ê°‘ìê¸° ì—ëŸ¬

2ë‹¨ê³„ê¹Œì§€ ìˆìœ¼ë©´:
localStorageì— user ìˆìŒ â†’ ì„œë²„ì— /api/auth/me í™•ì¸ â†’ ì„¸ì…˜ ë§Œë£Œ ê°ì§€
â†’ ì‹œê°„í‘œ í˜ì´ì§€ì— ë“¤ì–´ê°€ê¸° ì „ì— ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì•ˆë‚´
â†’ ê¹”ë”í•œ UX!
```

#### navigateì˜ state ì˜µì…˜

```typescript
navigate('/login', {
    state: {
        from: '/timetable',           // ì–´ë””ì„œ ì™”ëŠ”ì§€
        message: 'ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚'  // ì•ˆë‚´ ë©”ì‹œì§€
    }
});
```

- LoginPageì—ì„œ `useLocation()`ìœ¼ë¡œ ì´ ì •ë³´ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ
- ë¡œê·¸ì¸ í›„ `/timetable`ë¡œ ë‹¤ì‹œ ëŒì•„ì˜¬ ìˆ˜ ìˆìŒ (UX í–¥ìƒ)

---

### 3.3 ì‹œê°„í‘œ ê·¸ë¦¬ë“œ ë Œë”ë§

#### ê·¸ë¦¬ë“œ êµ¬ì¡°

```
          ì›”   í™”   ìˆ˜   ëª©   ê¸ˆ
1é™(9:00)  â–¡    â–¡    â–¡    â–¡    â–¡
2é™(10:30) â–¡    â–¡    â–¡    â–¡    â–¡
3é™(13:00) â–¡    â–¡    â–¡    â–¡    â–¡
4é™(14:30) â–¡    â–¡    â–¡    â–¡    â–¡
5é™(16:00) â–¡    â–¡    â–¡    â–¡    â–¡
```

#### DAYSì™€ PERIODS ìƒìˆ˜

```typescript
// types/timetable.tsì—ì„œ import
const DAYS = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘'];  // ì›”~ê¸ˆ
const PERIODS = [
    { number: 1, time: '9:00~10:30' },
    { number: 2, time: '10:40~12:10' },
    { number: 3, time: '13:00~14:30' },
    { number: 4, time: '14:40~16:10' },
    { number: 5, time: '16:20~17:50' }
];
```

#### ê·¸ë¦¬ë“œ ë Œë”ë§ ì½”ë“œ

```tsx
{PERIODS.map(period => (
    <div key={period.number} className="grid-row">
        {/* êµì‹œ í‘œì‹œ */}
        <div className="period-cell">
            <div className="period-number">{period.number}é™</div>
            <div className="period-time">{period.time}</div>
        </div>

        {/* ê° ìš”ì¼ì˜ ì…€ */}
        {DAYS.map((_, dayIndex) => {
            const day = dayIndex + 1;  // 0â†’1(ì›”), 1â†’2(í™”), ...
            const course = getCourseAtSlot(day, period.number);

            // ì—°ì† ê³¼ëª©ì˜ ì¤‘ê°„ ì…€ì€ ê±´ë„ˆë›°ê¸°
            if (course && !isStart) return null;

            return (
                <div
                    className={`course-cell ${course ? 'has-course' : ''}`}
                    style={{
                        backgroundColor: course?.colorCode || 'transparent',
                        gridRow: isStart ? `span ${span}` : undefined
                    }}
                    onClick={() => handleSlotClick(day, period.number)}
                >
                    {course && (
                        <div className="course-info">
                            <div className="course-name">{course.courseName}</div>
                            <div className="course-classroom">{course.classroom}</div>
                        </div>
                    )}
                </div>
            );
        })}
    </div>
))}
```

#### gridRow spanì˜ ì˜ë¯¸

```
"í”„ë¡œê·¸ë˜ë°" ê³¼ëª©: ì›”ìš”ì¼ 1~3êµì‹œ (3ì¹¸ ì°¨ì§€)

gridRow: "span 3"  â† ì´ ì…€ì´ ì„¸ë¡œë¡œ 3ì¹¸ì„ ì°¨ì§€

ì‹œê°ì  ê²°ê³¼:
          ì›”
1é™      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚í”„ë¡œê·¸ë˜ë° â”‚  â† 3ì¹¸ì„ í•˜ë‚˜ì˜ ë¸”ë¡ìœ¼ë¡œ í‘œì‹œ
2é™      â”‚          â”‚
         â”‚          â”‚
3é™      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
4é™        ë¹ˆ ì¹¸
```

#### getCourseAtSlot í•¨ìˆ˜ (íŠ¹ì • ìœ„ì¹˜ì˜ ê³¼ëª© ì°¾ê¸°)

```typescript
const getCourseAtSlot = (day: number, period: number): TimetableCourse | undefined => {
    return courses.find(c => {
        // ìƒˆ êµ¬ì¡° (daySchedules) ìš°ì„  í™•ì¸
        if (c.daySchedules && c.daySchedules.length > 0) {
            return c.daySchedules.some(schedule =>
                schedule.day === day &&
                schedule.periodStart <= period &&
                schedule.periodEnd >= period
            );
        }

        // êµ¬ êµ¬ì¡° (daysOfWeek + periodStart/End) í™•ì¸
        const days = c.daysOfWeek || (c.dayOfWeek ? [c.dayOfWeek] : []);
        return days.includes(day) &&
               (c.periodStart || 0) <= period &&
               (c.periodEnd || 0) >= period;
    });
};
```

**ì˜ˆì‹œ: í™”ìš”ì¼ 2êµì‹œì— ê³¼ëª©ì´ ìˆëŠ”ì§€ ì°¾ê¸°**
```
courses = [
  { courseName: "DB", daySchedules: [{day:1, periodStart:1, periodEnd:2}] },  // ì›” 1~2
  { courseName: "Net", daySchedules: [{day:2, periodStart:1, periodEnd:3}] }, // í™” 1~3
]

getCourseAtSlot(2, 2) â†’ "Net" ê³¼ëª© ì°¾ìŒ!
  day:2 === 2 âœ“, periodStart:1 <= 2 âœ“, periodEnd:3 >= 2 âœ“
```

---

### 3.4 ê³¼ëª© ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ

#### ìŠ¬ë¡¯ í´ë¦­ ì²˜ë¦¬

```typescript
const handleSlotClick = (day: number, period: number) => {
    const existingCourse = courses.find(c => { /* í•´ë‹¹ ìœ„ì¹˜ì— ê³¼ëª© ìˆëŠ”ì§€ */ });

    if (existingCourse) {
        setEditingCourse(existingCourse);   // ìˆ˜ì • ëª¨ë“œ
    } else {
        setSelectedSlot({ day, period });    // ì¶”ê°€ ëª¨ë“œ
    }
    setIsModalOpen(true);  // ëª¨ë‹¬ ì—´ê¸°
};
```

```
ë¹ˆ ì¹¸ í´ë¦­ â†’ selectedSlot ì„¤ì • â†’ ëª¨ë‹¬: "ê³¼ëª© ì¶”ê°€" ëª¨ë“œ
ê³¼ëª© í´ë¦­ â†’ editingCourse ì„¤ì • â†’ ëª¨ë‹¬: "ê³¼ëª© ìˆ˜ì •/ì‚­ì œ" ëª¨ë“œ
```

#### ê³¼ëª© ì €ì¥ ìš”ì²­

```typescript
const handleSaveCourse = async (course: TimetableCourse) => {
    // daySchedulesë¥¼ ë°±ì—”ë“œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    const daysOfWeek = course.daySchedules.map(s => s.day);

    const dataToSend = {
        ...course,
        timetableId: course.courseId ? undefined : timetable.timetableId,
        daysOfWeek,
        daySchedules: course.daySchedules  // ìƒˆ í˜•ì‹ë„ í•¨ê»˜ ì „ì†¡
    };

    if (course.courseId) {
        // ê¸°ì¡´ ê³¼ëª© ìˆ˜ì •
        await axios.put(`/api/timetable/course/${course.courseId}`, dataToSend, {
            withCredentials: true
        });
    } else {
        // ìƒˆ ê³¼ëª© ì¶”ê°€
        await axios.post('/api/timetable/course', dataToSend, {
            withCredentials: true
        });
    }
    loadTimetable();  // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    closeModal();
};
```

#### courseId ìœ ë¬´ë¡œ ì‹ ê·œ/ìˆ˜ì • êµ¬ë¶„

```
course.courseIdê°€ ì—†ìœ¼ë©´ â†’ POST (ìƒˆë¡œ ì¶”ê°€)
course.courseIdê°€ ìˆìœ¼ë©´ â†’ PUT  (ê¸°ì¡´ ìˆ˜ì •)

ì´ íŒ¨í„´ì€ ì›¹ ê°œë°œì—ì„œ ë§¤ìš° í”í•©ë‹ˆë‹¤:
"IDê°€ ì—†ë‹¤ = ì•„ì§ DBì— ì—†ë‹¤ = ìƒˆë¡œ ë§Œë“¤ì–´ì•¼ í•œë‹¤"
"IDê°€ ìˆë‹¤ = ì´ë¯¸ DBì— ìˆë‹¤ = ìˆ˜ì •í•´ì•¼ í•œë‹¤"
```

#### ì´ í•™ì  ê³„ì‚°

```typescript
const totalCredits = courses.reduce((sum, course) => {
    return sum + (course.credits || 0);
}, 0);
// í™”ë©´ í‘œì‹œ: ğŸ“š å±¥ä¿®å˜ä½: 15.0
```

**reduce í•¨ìˆ˜ ì„¤ëª…**:
```typescript
// reduce(ì½œë°±í•¨ìˆ˜, ì´ˆê¸°ê°’)
// ë°°ì—´ì˜ ëª¨ë“  ìš”ì†Œë¥¼ í•˜ë‚˜ì˜ ê°’ìœ¼ë¡œ í•©ì¹¨

[3, 3, 2, 3, 2].reduce((í•©ê³„, í˜„ì¬ê°’) => í•©ê³„ + í˜„ì¬ê°’, 0)
// 0 + 3 = 3
// 3 + 3 = 6
// 6 + 2 = 8
// 8 + 3 = 11
// 11 + 2 = 13  â† ìµœì¢… ê²°ê³¼
```

---

### 3.5 í•˜ìœ„ í˜¸í™˜ì„± ì²˜ë¦¬

ì´ í”„ë¡œì íŠ¸ëŠ” ë°ì´í„° êµ¬ì¡°ê°€ 3ë²ˆ ë³€ê²½ë˜ì—ˆê¸° ë•Œë¬¸ì—, ëª¨ë“  í˜•ì‹ì„ ì§€ì›í•´ì•¼ í•©ë‹ˆë‹¤.

```typescript
// 3ì„¸ëŒ€ êµ¬ì¡° (daySchedules)
if (c.daySchedules && c.daySchedules.length > 0) {
    return c.daySchedules.some(schedule =>
        schedule.day === day && ...
    );
}

// 2ì„¸ëŒ€ êµ¬ì¡° (daysOfWeek ë°°ì—´)
// 1ì„¸ëŒ€ êµ¬ì¡° (dayOfWeek ë‹¨ì¼ê°’)
const days = c.daysOfWeek || (c.dayOfWeek ? [c.dayOfWeek] : []);
return days.includes(day) && ...;
```

**í•˜ìœ„ í˜¸í™˜ì„±ì´ ì¤‘ìš”í•œ ì´ìœ **:
```
ê¸°ì¡´ DBì— 1ì„¸ëŒ€ í˜•ì‹ìœ¼ë¡œ ì €ì¥ëœ ê³¼ëª©ì´ ìˆëŠ” ìƒíƒœì—ì„œ
ìƒˆ ì½”ë“œê°€ 3ì„¸ëŒ€ í˜•ì‹ë§Œ ì½ìœ¼ë©´
â†’ ê¸°ì¡´ ê³¼ëª©ì´ í™”ë©´ì— ì•ˆ ë³´ì„!

í•´ê²°: ìƒˆ êµ¬ì¡° í™•ì¸ â†’ ì—†ìœ¼ë©´ â†’ êµ¬ êµ¬ì¡°ë¡œ í´ë°±
```

---

## 4. ë°ì´í„° êµ¬ì¡° ì„¤ê³„

### API ìš”ì²­/ì‘ë‹µ ì˜ˆì‹œ

**ì‹œê°„í‘œ ì¡°íšŒ ìš”ì²­**:
```
GET /api/timetable?year=2026&semester=spring
Cookie: JSESSIONID=abc123
```

**ì‹œê°„í‘œ ì¡°íšŒ ì‘ë‹µ**:
```json
{
  "timetable": {
    "timetableId": 1,
    "userId": 5,
    "year": 2026,
    "semester": "spring",
    "name": null
  },
  "courses": [
    {
      "courseId": 10,
      "courseName": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹",
      "professorName": "ç”°ä¸­å…ˆç”Ÿ",
      "classroom": "å·¥å­¦é¤¨301",
      "daySchedules": [
        { "day": 1, "periodStart": 1, "periodEnd": 2 },
        { "day": 3, "periodStart": 1, "periodEnd": 2 }
      ],
      "credits": 3.0,
      "colorCode": "#3b82f6"
    }
  ]
}
```

**ê³¼ëª© ì¶”ê°€ ìš”ì²­**:
```
POST /api/timetable/course
Content-Type: application/json
Cookie: JSESSIONID=abc123

{
  "timetableId": 1,
  "courseName": "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯",
  "professorName": "ä½è—¤å…ˆç”Ÿ",
  "classroom": "æƒ…å ±é¤¨201",
  "daySchedules": [
    { "day": 2, "periodStart": 3, "periodEnd": 4 }
  ],
  "daysOfWeek": [2],
  "periodStart": 3,
  "periodEnd": 4,
  "credits": 2.0,
  "colorCode": "#ef4444"
}
```

---

## 5. ê¶Œí•œ ê²€ì‚¬ íë¦„

```
[ê³¼ëª© ìˆ˜ì • ìš”ì²­]
    â†“
[1] ì„¸ì…˜ì—ì„œ userId ì¶”ì¶œ (getLoggedInUserId)
    â†’ nullì´ë©´ 401 ë°˜í™˜
    â†“
[2] ê³¼ëª©ì˜ ì†Œìœ ìì¸ì§€ í™•ì¸ (isCourseOwner)
    course â†’ timetable â†’ userId === ì„¸ì…˜ì˜ userId?
    â†’ ë¶ˆì¼ì¹˜í•˜ë©´ 403 ë°˜í™˜
    â†“
[3] ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰ (ì‹œê°„ ì¶©ëŒ ê²€ì‚¬ â†’ ì €ì¥)
```

| HTTP ìƒíƒœ | ì˜ë¯¸ | ë°œìƒ ìƒí™© |
|-----------|------|----------|
| 200 | ì„±ê³µ | ì •ìƒ ì²˜ë¦¬ |
| 401 | ì¸ì¦ í•„ìš” | ë¡œê·¸ì¸í•˜ì§€ ì•ŠìŒ |
| 403 | ê¶Œí•œ ì—†ìŒ | ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì‹œê°„í‘œ ìˆ˜ì • ì‹œë„ |
| 400 | ì˜ëª»ëœ ìš”ì²­ | ì‹œê°„ ì¶©ëŒ, í•„ìˆ˜ ê°’ ëˆ„ë½ ë“± |

---

## 6. ìì£¼ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì™€ í•´ê²°ë²•

### ì—ëŸ¬ 1: ì‹œê°„í‘œê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ

**ì¦ìƒ**: ë¹ˆ ê·¸ë¦¬ë“œë§Œ í‘œì‹œë¨

**í™•ì¸ ìˆœì„œ**:
```javascript
// ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í™•ì¸
console.log(timetable);  // nullì´ë©´ ì‹œê°„í‘œ ë¡œë“œ ì‹¤íŒ¨
console.log(courses);     // []ì´ë©´ ê³¼ëª©ì´ ì—†ê±°ë‚˜ ë¡œë“œ ì‹¤íŒ¨
```

**í•´ê²°**: Network íƒ­ì—ì„œ `/api/timetable?year=...&semester=...` ì‘ë‹µ í™•ì¸

### ì—ëŸ¬ 2: "ã“ã®æ™‚é–“ã«ã¯æ—¢ã«ç§‘ç›®ãŒã‚ã‚Šã¾ã™"

**ì›ì¸**: ê°™ì€ ì‹œê°„ëŒ€ì— ì´ë¯¸ ê³¼ëª©ì´ ì¡´ì¬

**í•´ê²°**: ë‹¤ë¥¸ ì‹œê°„ëŒ€ë¥¼ ì„ íƒí•˜ê±°ë‚˜, ê¸°ì¡´ ê³¼ëª©ì„ ë¨¼ì € ì‚­ì œ

### ì—ëŸ¬ 3: TypeScript ì»´íŒŒì¼ ì—ëŸ¬

```
Type 'string' is not assignable to type 'number'
```

**ì›ì¸**: HTML selectì—ì„œ ë°›ì€ ê°’ì€ í•­ìƒ string
**í•´ê²°**: `Number(e.target.value)`ë¡œ ë³€í™˜
```typescript
onChange={(e) => setSelectedYear(Number(e.target.value))}
```

### ì—ëŸ¬ 4: gridRow spanì´ ì´ìƒí•˜ê²Œ í‘œì‹œë¨

**ì›ì¸**: `isStart`ê°€ falseì¸ ì¤‘ê°„ ì…€ì´ ë Œë”ë§ë¨

**í•´ê²°**: ì¤‘ê°„ ì…€ì€ `return null`ë¡œ ê±´ë„ˆë›°ì–´ì•¼ í•¨
```typescript
if (course && !isStart) {
    return null;  // ì—°ì† ê³¼ëª©ì˜ ì¤‘ê°„ ì…€ì€ ë Œë”ë§í•˜ì§€ ì•ŠìŒ
}
```

---

> ì´ì „ ë¬¸ì„œ: [02. ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° êµ¬í˜„ ê°€ì´ë“œ](./02_ì•„ì´ë””_ë¹„ë°€ë²ˆí˜¸_ì°¾ê¸°_êµ¬í˜„_ê°€ì´ë“œ.md)
> ë‹¤ìŒ ë¬¸ì„œ: [04. ê´€ë¦¬ì í˜ì´ì§€ + ì‹ ê³  í˜ì´ì§€ êµ¬í˜„ ê°€ì´ë“œ](./04_ê´€ë¦¬ì_ì‹ ê³ _í˜ì´ì§€_êµ¬í˜„_ê°€ì´ë“œ.md)
