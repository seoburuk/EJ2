# 📸 이미지 업로드 기능 완벽 가이드 (초보자용)

> EJ2 게시판에 이미지를 올리고 보여주는 기능을 처음부터 끝까지 설명합니다.

---

## 📋 목차

1. [이미지 업로드 기능이란?](#이미지-업로드-기능이란)
2. [어떻게 작동하나요?](#어떻게-작동하나요)
3. [필요한 것들](#필요한-것들)
4. [AWS S3 설정하기 (단계별)](#aws-s3-설정하기-단계별)
5. [프로그램 설정하기](#프로그램-설정하기)
6. [실행하기](#실행하기)
7. [사용 방법](#사용-방법)
8. [문제 해결](#문제-해결)
9. [자주 묻는 질문](#자주-묻는-질문)

---

## 이미지 업로드 기능이란?

### 🤔 쉽게 설명하면?

게시판에 글을 쓸 때 **사진을 함께 올릴 수 있는 기능**입니다.

예를 들어:
- 강의 자료 사진 공유
- 시간표 캡처 이미지 올리기
- 행사 포스터 첨부
- 질문할 때 화면 캡처 올리기

### ✨ 무엇을 할 수 있나요?

- ✅ 한 게시글에 **최대 5장**의 사진 업로드
- ✅ 각 사진은 **최대 5MB**까지
- ✅ JPG, PNG, GIF, WEBP 형식 지원
- ✅ 사진이 예쁘게 정렬되어 보임
- ✅ 게시글을 삭제하면 사진도 자동으로 삭제됨

### 🎯 언제 사용하나요?

| 상황 | 예시 |
|------|------|
| 📚 공부 자료 공유 | 교수님이 보드에 쓴 내용 사진 |
| 📅 시간표 공유 | 내 시간표 캡처 올리기 |
| 🎉 행사 홍보 | 축제 포스터 이미지 |
| ❓ 질문하기 | 에러 메시지 화면 캡처 |

---

## 어떻게 작동하나요?

### 🔄 전체 흐름 (쉬운 버전)

```
1. 사용자가 글 작성
   ↓
2. 사용자가 사진 선택 (최대 5장)
   ↓
3. "게시" 버튼 클릭
   ↓
4. 먼저 글만 저장 (제목, 내용)
   ↓
5. 그 다음 사진들을 AWS S3에 업로드
   ↓
6. 사진 정보를 데이터베이스에 저장
   ↓
7. 완료! 게시글 상세 페이지로 이동
```

### 🏗️ 시스템 구조 (쉬운 버전)

```
┌─────────────────┐
│   웹 브라우저    │ ← 사용자가 보는 화면
│   (React)       │
└────────┬────────┘
         │
         ↓ (사진 업로드 요청)
┌─────────────────┐
│  백엔드 서버     │ ← 사진을 처리하는 프로그램
│  (Spring)       │
└────┬───────┬────┘
     │       │
     ↓       ↓
┌─────┐  ┌─────────┐
│ DB  │  │  AWS S3 │ ← 실제 사진 파일이 저장되는 곳
└─────┘  └─────────┘
```

### 🎯 왜 2단계로 나눠서 업로드하나요?

**일반적인 방법 (X)**:
```
글 작성 → 글 + 사진을 한 번에 저장 → 완료
```
❌ 문제점: 사진 업로드가 실패하면 글도 사라짐!

**우리가 사용하는 방법 (O)**:
```
1단계: 글 먼저 저장 → 글 번호 받음
2단계: 그 글 번호로 사진 업로드
```
✅ 장점: 사진 업로드가 실패해도 글은 남아있음!

---

## 필요한 것들

### 📦 준비물 체크리스트

#### 1. AWS 계정 (필수!)
- [ ] AWS 계정 만들기 (https://aws.amazon.com)
- [ ] 신용카드 등록 (처음 1년은 거의 무료)

#### 2. 프로그램 설치
- [ ] Docker Desktop (프로그램 실행용)
- [ ] 텍스트 에디터 (VS Code 추천)
- [ ] Git (코드 받기용)

#### 3. 이 프로젝트 코드
- [ ] EJ2 프로젝트 다운로드
- [ ] `/Users/yunsu-in/Downloads/EJ2` 폴더에 있음

---

## AWS S3 설정하기 (단계별)

> ⚠️ **주의**: 이 과정은 처음 1번만 하면 됩니다!

### 🪣 STEP 1: S3 버킷 만들기 (5분)

**버킷이란?** 사진을 저장하는 폴더 같은 것입니다.

#### 1-1. AWS 콘솔 접속
```
1. https://aws.amazon.com 접속
2. "로그인" 클릭
3. 이메일/비밀번호 입력
4. 검색창에 "S3" 입력
5. "S3" 서비스 클릭
```

#### 1-2. 버킷 만들기
```
1. 주황색 "버킷 만들기" 버튼 클릭
2. 다음 정보 입력:

   버킷 이름: ej2-post-images
   ※ 이름은 전 세계에서 유일해야 함!
   ※ 이미 사용 중이면 ej2-post-images-yourname 처럼 수정

   리전: 아시아 태평양(서울) ap-northeast-2
   ※ 한국에서 가장 빠름!
```

#### 1-3. 공개 설정 (중요!)
```
❌ "모든 퍼블릭 액세스 차단" 체크 해제!

왜? → 사진을 웹에서 볼 수 있어야 하니까요!

⚠️ 보안 걱정? 괜찮아요!
   - 사진은 보기만 가능 (수정/삭제 불가)
   - 업로드는 우리 서버만 가능
```

#### 1-4. 암호화 설정
```
✅ "서버 측 암호화" 활성화
   - AES-256 선택
   - 사진을 안전하게 보관!
```

#### 1-5. 생성 완료
```
"버킷 만들기" 버튼 클릭!

✅ 성공하면 버킷 목록에 표시됨
```

### 🔗 STEP 2: CORS 설정하기 (3분)

**CORS란?** 웹 페이지에서 사진에 접근할 수 있게 해주는 설정입니다.

#### 2-1. 버킷 선택
```
1. 방금 만든 버킷(ej2-post-images) 클릭
2. "권한" 탭 클릭
3. 아래로 스크롤해서 "CORS(Cross-origin 리소스 공유)" 찾기
4. "편집" 버튼 클릭
```

#### 2-2. CORS 규칙 입력
```json
[
  {
    "AllowedOrigins": [
      "http://localhost:3000",
      "https://yourdomain.com"
    ],
    "AllowedMethods": ["GET", "PUT", "POST", "DELETE"],
    "AllowedHeaders": ["*"],
    "MaxAgeSeconds": 3000
  }
]
```

**쉽게 설명하면:**
- `AllowedOrigins`: 어떤 웹사이트에서 접근 가능한지
  - `localhost:3000`: 개발할 때 사용
  - `yourdomain.com`: 나중에 실제 도메인으로 바꾸기
- `AllowedMethods`: 무엇을 할 수 있는지
  - GET: 사진 보기
  - PUT, POST: 사진 올리기
  - DELETE: 사진 삭제

#### 2-3. 저장
```
"변경 사항 저장" 버튼 클릭!
```

### 🔓 STEP 3: 공개 읽기 허용하기 (3분)

**왜 필요한가요?** 사람들이 웹에서 사진을 볼 수 있어야 하니까요!

#### 3-1. 버킷 정책 편집
```
1. 같은 "권한" 탭에서
2. "버킷 정책" 섹션 찾기
3. "편집" 버튼 클릭
```

#### 3-2. 정책 입력
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadGetObject",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::ej2-post-images/*"
    }
  ]
}
```

**⚠️ 중요**: `ej2-post-images` 부분을 여러분의 버킷 이름으로 바꾸세요!

**쉽게 설명하면:**
- `Principal: "*"`: 모든 사람
- `Action: "s3:GetObject"`: 사진 보기만 가능
- `Resource`: 이 버킷의 모든 파일

#### 3-3. 저장
```
"변경 사항 저장" 버튼 클릭!
```

### 👤 STEP 4: IAM 사용자 만들기 (10분)

**IAM 사용자란?** 프로그램이 AWS에 접속할 때 사용하는 "계정"입니다.

#### 4-1. IAM 서비스 접속
```
1. AWS 콘솔 왼쪽 위 검색창
2. "IAM" 검색
3. "IAM" 서비스 클릭
```

#### 4-2. 사용자 만들기
```
1. 왼쪽 메뉴에서 "사용자" 클릭
2. "사용자 생성" 버튼 클릭
3. 사용자 이름 입력: ej2-s3-uploader
4. "다음" 클릭
```

#### 4-3. 권한 설정 - 정책 만들기
```
1. "직접 정책 연결" 선택
2. "정책 생성" 버튼 클릭 (새 탭이 열림)
3. "JSON" 탭 클릭
4. 다음 내용을 붙여넣기:
```

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:DeleteObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::ej2-post-images",
        "arn:aws:s3:::ej2-post-images/*"
      ]
    }
  ]
}
```

**⚠️ 중요**: `ej2-post-images` 부분을 여러분의 버킷 이름으로 바꾸세요!

**각 권한의 의미:**
- `PutObject`: 사진 올리기 ✅
- `GetObject`: 사진 읽기 ✅
- `DeleteObject`: 사진 삭제 ✅
- `ListBucket`: 사진 목록 보기 ✅

```
5. "다음" 클릭
6. 정책 이름 입력: EJ2-S3-Upload-Policy
7. "정책 생성" 버튼 클릭
8. 이 탭 닫기
```

#### 4-4. 정책 연결
```
1. 원래 탭으로 돌아가기
2. 🔄 새로고침 버튼 클릭
3. 검색창에 "EJ2-S3-Upload-Policy" 입력
4. 체크박스 선택
5. "다음" 클릭
6. "사용자 생성" 버튼 클릭
```

### 🔑 STEP 5: 액세스 키 발급받기 (5분)

**액세스 키란?** 프로그램이 AWS에 로그인할 때 사용하는 "ID와 비밀번호"입니다.

#### 5-1. 액세스 키 생성
```
1. 방금 만든 사용자(ej2-s3-uploader) 클릭
2. "보안 자격 증명" 탭 클릭
3. 아래로 스크롤해서 "액세스 키" 섹션 찾기
4. "액세스 키 만들기" 버튼 클릭
```

#### 5-2. 사용 사례 선택
```
1. "애플리케이션" 선택
2. 아래 체크박스 선택
   ✅ "위의 권장 사항을 이해했으며..."
3. "다음" 클릭
```

#### 5-3. 설명 추가 (선택사항)
```
설명 태그 값: EJ2 게시판 이미지 업로드용
"액세스 키 만들기" 버튼 클릭
```

#### 5-4. ⚠️ **중요!** 키 저장하기
```
✅ 이 화면을 절대 닫지 마세요!

메모장을 열고 다음을 복사:

액세스 키: AKIA****************** (예시)
비밀 액세스 키: **************************************** (예시)

📝 안전한 곳에 저장!
   - 비밀 키는 다시 볼 수 없어요!
   - 절대 다른 사람에게 공유 금지!
   - Git에 올리지 않기!
```

#### 5-5. CSV 다운로드 (추천)
```
"CSV 파일 다운로드" 버튼 클릭
→ 안전한 곳에 보관!
```

---

## 프로그램 설정하기

### 📝 STEP 1: .env 파일 만들기

#### 1-1. 터미널 열기
```bash
# Mac/Linux
터미널 앱 실행

# Windows
Git Bash 또는 PowerShell 실행
```

#### 1-2. 프로젝트 폴더로 이동
```bash
cd /Users/yunsu-in/Downloads/EJ2
```

#### 1-3. .env.example 파일 복사
```bash
cp .env.example .env
```

**Windows에서는:**
```bash
copy .env.example .env
```

#### 1-4. .env 파일 편집
```bash
# VS Code로 열기
code .env

# 또는 메모장으로 열기
notepad .env  # Windows
open -a TextEdit .env  # Mac
```

#### 1-5. AWS 정보 입력
```
AWS_S3_ACCESS_KEY=AKIA여기에여러분의액세스키
AWS_S3_SECRET_KEY=여기에여러분의시크릿키입력
AWS_S3_BUCKET_NAME=ej2-post-images
AWS_S3_REGION=ap-northeast-2
```

**⚠️ 주의사항:**
- `=` 앞뒤에 공백 없이!
- 따옴표 없이!
- 한 줄에 하나씩!

**올바른 예:**
```
AWS_S3_ACCESS_KEY=AKIAIOSFODNN7EXAMPLE
```

**잘못된 예:**
```
AWS_S3_ACCESS_KEY = "AKIAIOSFODNN7EXAMPLE"  ❌ (공백, 따옴표 있음)
```

#### 1-6. 저장하기
```
Ctrl + S (Windows/Linux)
Cmd + S (Mac)
```

### ✅ STEP 2: 설정 확인하기

#### 2-1. .env 파일 확인
```bash
# 파일 내용 보기 (비밀번호가 보이니 주의!)
cat .env
```

**다음과 같이 보여야 합니다:**
```
AWS_S3_ACCESS_KEY=AKIA...
AWS_S3_SECRET_KEY=...
AWS_S3_BUCKET_NAME=ej2-post-images
AWS_S3_REGION=ap-northeast-2
```

#### 2-2. .gitignore 확인
```bash
# .env가 Git에 안 올라가는지 확인
cat .gitignore | grep .env
```

**다음 줄이 있어야 합니다:**
```
.env
.env.local
.env.development.local
```

---

## 실행하기

### 🚀 STEP 1: Docker로 실행하기

#### 1-1. Docker Desktop 실행
```
1. Docker Desktop 앱 실행
2. Docker가 완전히 시작될 때까지 대기
   (화면 아래 "Docker Desktop is running" 표시)
```

#### 1-2. 프로젝트 실행
```bash
# EJ2 폴더로 이동 (아직 안 했다면)
cd /Users/yunsu-in/Downloads/EJ2

# Docker Compose로 모든 서비스 시작
docker-compose up --build
```

**화면에 표시되는 내용:**
```
Creating network "ej2_app-network" with driver "bridge"
Creating mariadb ... done
Creating spring-backend ... done
Creating react-frontend ... done
Attaching to mariadb, spring-backend, react-frontend
...
spring-backend | Tomcat started on port(s): 8080 (http)
react-frontend | webpack compiled successfully
```

#### 1-3. 성공 확인
```
✅ "webpack compiled successfully" 보이면 성공!

접속 주소:
- 프론트엔드: http://localhost:3000
- 백엔드 API: http://localhost:8080/ej2/api
```

### 🔍 STEP 2: 테스트하기

#### 2-1. 웹 브라우저 열기
```
http://localhost:3000
```

#### 2-2. 로그인하기
```
1. 로그인 화면으로 이동
2. 테스트 계정으로 로그인
   (계정 만들기 필요할 수 있음)
```

#### 2-3. 게시판 선택
```
1. 원하는 게시판 클릭
2. "글쓰기" 버튼 클릭
```

#### 2-4. 이미지 첨부 테스트
```
1. 제목 입력: "이미지 테스트"
2. 내용 입력: "업로드 테스트 중입니다"
3. "이미지 선택" 버튼 클릭
4. 사진 1~2장 선택
5. 미리보기 확인
6. "게시" 버튼 클릭
```

#### 2-5. 결과 확인
```
✅ 게시글 상세 페이지로 이동
✅ 내용 아래에 이미지 표시됨
✅ 이미지가 예쁘게 정렬됨
```

### 📊 STEP 3: 백엔드 로그 확인하기

```bash
# 새 터미널 창 열기
docker logs spring-backend

# 실시간 로그 보기
docker logs -f spring-backend
```

**성공 시 로그:**
```
INFO  c.e.s.S3Service - Uploading file to S3: posts/1/uuid.jpg
INFO  c.e.s.PostImageService - Image uploaded successfully
INFO  c.e.c.PostImageController - Uploaded 2 images for post 1
```

**에러 발생 시:**
```
ERROR c.e.s.S3Service - Failed to upload to S3
com.amazonaws.services.s3.model.AmazonS3Exception: Access Denied
```
→ [문제 해결](#문제-해결) 섹션 참고

---

## 사용 방법

### 📝 사용자 가이드

#### 1. 이미지와 함께 게시글 작성하기

**STEP 1: 게시판 선택**
```
1. 메인 페이지에서 원하는 게시판 클릭
   예: "자유 게시판"

2. 우측 상단 "글쓰기" 버튼 클릭
```

**STEP 2: 글 작성**
```
3. 제목 입력 (필수)
   - 최대 255자
   - 예: "시간표 추천 부탁드려요"

4. 내용 입력 (필수)
   - 최대 5,000자
   - 예: "1학년인데 어떤 과목 들으면 좋을까요?"
```

**STEP 3: 이미지 선택**
```
5. 아래로 스크롤해서 "이미지" 섹션 찾기

6. "이미지 선택" 버튼 클릭
   또는 파일을 드래그 앤 드롭

7. 사진 선택
   - 최대 5장
   - 각 사진 5MB 이하
   - JPG, PNG, GIF, WEBP만 가능

8. 선택한 이미지 확인
   - 작은 미리보기 표시됨
   - X 버튼으로 삭제 가능
   - 순서는 선택한 순서대로
```

**STEP 4: 게시**
```
9. "게시" 버튼 클릭

10. 처리 중... (1~5초 소요)
    - 먼저 글 저장
    - 그 다음 이미지 업로드

11. 완료!
    - 자동으로 게시글 상세 페이지로 이동
    - 이미지가 예쁘게 표시됨
```

#### 2. 이미지가 있는 게시글 보기

**게시글 목록에서:**
```
- 이미지가 있는 글은 📷 아이콘 표시 (예정)
- 제목 클릭해서 상세 페이지로 이동
```

**게시글 상세 페이지에서:**
```
1. 제목과 내용 표시
2. 내용 아래에 이미지 갤러리
3. 여러 장이면 그리드로 정렬
   - 1장: 큰 사이즈로 중앙에
   - 2장: 좌우로 배치
   - 3장 이상: 격자 형태

4. 이미지에 마우스 올리면
   - 살짝 확대됨
   - 그림자 효과
```

#### 3. 게시글 수정하기

```
1. 자신의 게시글 상세 페이지
2. "수정" 버튼 클릭
3. 내용 수정 가능
4. ⚠️ 이미지는 아직 수정 불가 (추후 구현 예정)
5. "저장" 버튼 클릭
```

#### 4. 게시글 삭제하기

```
1. 자신의 게시글 상세 페이지
2. "삭제" 버튼 클릭
3. 확인 대화상자:
   "정말 삭제하시겠습니까?"
4. "확인" 클릭
5. 게시글과 모든 이미지가 삭제됨
   - DB에서 삭제
   - S3에서도 삭제
   - 완전히 사라짐!
```

### 👨‍💼 관리자 가이드

#### 1. 데이터베이스에서 이미지 정보 확인

```bash
# MariaDB 컨테이너 접속
docker exec -it mariadb mysql -u appuser -p

# 비밀번호 입력: apppassword
```

```sql
-- appdb 데이터베이스 선택
USE appdb;

-- 모든 이미지 정보 보기
SELECT * FROM post_images;

-- 특정 게시글의 이미지만 보기
SELECT * FROM post_images WHERE post_id = 1;

-- 이미지 개수 세기
SELECT COUNT(*) FROM post_images;

-- 용량이 큰 이미지 찾기
SELECT id, post_id, file_size, original_filename
FROM post_images
WHERE file_size > 4000000  -- 4MB 이상
ORDER BY file_size DESC;
```

#### 2. S3에서 실제 파일 확인

**AWS 콘솔에서:**
```
1. S3 서비스 접속
2. ej2-post-images 버킷 클릭
3. posts/ 폴더 클릭
4. 각 게시글 번호별 폴더 확인
   예: posts/1/, posts/2/, ...
5. 파일 클릭해서 미리보기
```

**AWS CLI로:**
```bash
# 모든 파일 목록 보기
aws s3 ls s3://ej2-post-images/posts/ --recursive

# 특정 게시글 폴더만 보기
aws s3 ls s3://ej2-post-images/posts/1/

# 파일 개수 세기
aws s3 ls s3://ej2-post-images/posts/ --recursive | wc -l
```

#### 3. 로그 모니터링

**백엔드 로그 실시간 보기:**
```bash
docker logs -f spring-backend | grep -i "image"
```

**주요 로그 메시지:**
```
✅ 성공:
INFO  c.e.s.S3Service - Uploading file to S3
INFO  c.e.s.PostImageService - Image uploaded successfully

❌ 에러:
ERROR c.e.s.S3Service - Failed to upload file to S3
ERROR c.e.c.PostImageController - Image upload failed
```

#### 4. 문제가 있는 이미지 정리

**고아 이미지 찾기 (게시글이 없는 이미지):**
```sql
-- DB에는 있지만 게시글이 삭제된 이미지
SELECT pi.*
FROM post_images pi
LEFT JOIN posts p ON pi.post_id = p.id
WHERE p.id IS NULL;
```

**S3에서 수동 삭제:**
```bash
# 특정 게시글의 모든 이미지 삭제
aws s3 rm s3://ej2-post-images/posts/123/ --recursive

# 특정 파일만 삭제
aws s3 rm s3://ej2-post-images/posts/123/uuid.jpg
```

---

## 문제 해결

### ❌ 문제 1: 이미지를 업로드할 수 없어요

#### 증상
- "게시" 버튼을 눌러도 이미지가 안 올라감
- 에러 메시지: "이미지 업로드에 실패했습니다"

#### 원인 1: .env 파일이 없거나 잘못됨

**확인 방법:**
```bash
# .env 파일이 있는지 확인
ls -la .env

# 파일 내용 확인 (비밀번호 주의!)
cat .env
```

**해결 방법:**
```bash
# .env 파일이 없으면 만들기
cp .env.example .env

# VS Code로 편집
code .env

# AWS 정보 정확히 입력
AWS_S3_ACCESS_KEY=여러분의_액세스_키
AWS_S3_SECRET_KEY=여러분의_시크릿_키
AWS_S3_BUCKET_NAME=ej2-post-images
AWS_S3_REGION=ap-northeast-2

# 저장하고 Docker 재시작
docker-compose restart backend
```

#### 원인 2: AWS 액세스 키가 틀림

**확인 방법:**
```bash
# 백엔드 로그 확인
docker logs spring-backend | grep -i "credentials"
```

**에러 메시지:**
```
The AWS Access Key Id you provided does not exist
또는
SignatureDoesNotMatch
```

**해결 방법:**
```
1. AWS 콘솔 접속
2. IAM → 사용자 → ej2-s3-uploader
3. 보안 자격 증명 탭
4. 기존 액세스 키 "비활성화" 또는 "삭제"
5. 새 액세스 키 생성
6. .env 파일에 새 키 입력
7. Docker 재시작
```

#### 원인 3: 버킷 이름이 틀림

**확인 방법:**
```bash
# .env 파일의 버킷 이름 확인
cat .env | grep BUCKET_NAME

# AWS 콘솔에서 실제 버킷 이름 확인
```

**해결 방법:**
```
.env 파일에서 버킷 이름을 정확히 수정

AWS_S3_BUCKET_NAME=실제_버킷_이름
```

#### 원인 4: IAM 권한 부족

**에러 로그:**
```
AmazonS3Exception: Access Denied (Service: Amazon S3; Status Code: 403)
```

**해결 방법:**
```
1. AWS 콘솔 → IAM → 사용자 → ej2-s3-uploader
2. 권한 탭 확인
3. EJ2-S3-Upload-Policy가 있는지 확인
4. 없으면 정책 연결
5. 정책 내용 확인:
   - s3:PutObject ✅
   - s3:GetObject ✅
   - s3:DeleteObject ✅
   - s3:ListBucket ✅
```

### ❌ 문제 2: 이미지가 화면에 안 보여요

#### 증상
- 업로드는 성공했는데
- 게시글 상세 페이지에서 이미지가 안 보임
- 브라우저 콘솔에 에러 메시지

#### 원인 1: CORS 설정 문제

**확인 방법:**
```
1. F12 눌러서 개발자 도구 열기
2. Console 탭 선택
3. 에러 메시지 확인:
   "has been blocked by CORS policy"
```

**해결 방법:**
```
1. AWS 콘솔 → S3 → ej2-post-images
2. 권한 탭 → CORS
3. 다음 내용으로 수정:

[
  {
    "AllowedOrigins": ["*"],
    "AllowedMethods": ["GET", "PUT", "POST", "DELETE"],
    "AllowedHeaders": ["*"],
    "MaxAgeSeconds": 3000
  }
]

4. 변경 사항 저장
5. 브라우저 새로고침 (Ctrl+F5)
```

#### 원인 2: 버킷 정책 문제

**확인 방법:**
```
1. 이미지 URL을 브라우저에 직접 입력
   예: https://ej2-post-images.s3.ap-northeast-2.amazonaws.com/posts/1/uuid.jpg
2. "403 Forbidden" 나오면 권한 문제
```

**해결 방법:**
```
1. S3 → ej2-post-images → 권한 → 버킷 정책
2. 다음 정책 확인 및 수정:

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::ej2-post-images/*"
    }
  ]
}

3. 버킷 이름 확인 (ej2-post-images)
4. /* 빠뜨리지 않기!
5. 저장
```

#### 원인 3: 퍼블릭 액세스 차단

**확인 방법:**
```
S3 → ej2-post-images → 권한
"퍼블릭 액세스 차단" 섹션 확인
```

**해결 방법:**
```
✅ 다음 항목이 모두 "꺼짐"이어야 함:
- 새 ACL을 통해 부여된 퍼블릭 액세스 차단
- 임의의 ACL을 통해 부여된 퍼블릭 액세스 차단
- 새 퍼블릭 버킷 또는 액세스 포인트 정책을 통해 부여된 퍼블릭 액세스 차단
- 임의의 퍼블릭 버킷 또는 액세스 포인트 정책을 통해 퍼블릭 및 교차 계정 액세스 차단

"편집" → 모든 체크박스 해제 → "변경 사항 저장"
```

### ❌ 문제 3: 파일 크기 에러

#### 증상
- "파일이 너무 큽니다" 에러
- 5MB보다 작은데도 안 됨

#### 원인: 실제 파일 크기 확인 필요

**확인 방법:**
```
Windows:
파일 우클릭 → 속성 → "크기" 확인 (MB 단위)

Mac:
파일 우클릭 → 정보 가져오기 → "크기" 확인
```

**파일 크기 줄이기:**
```
방법 1: 온라인 압축 도구 사용
- https://tinypng.com (PNG)
- https://tinyjpg.com (JPG)

방법 2: 그림판에서 크기 조정
1. 그림판에서 이미지 열기
2. 크기 조정 → 픽셀 → 800x600 정도로 축소
3. 다른 이름으로 저장

방법 3: Mac 미리보기
1. 이미지를 미리보기로 열기
2. 도구 → 크기 조정
3. 폭 800픽셀 정도로 설정
4. 저장
```

### ❌ 문제 4: 게시글은 생성됐는데 이미지만 안 올라감

#### 증상
- 게시글은 정상적으로 생성됨
- 하지만 이미지가 0개
- 에러 메시지: "투고는 작성되었지만..."

#### 원인: 2단계 업로드 중 2단계 실패

**이것은 정상입니다!**
```
✅ 장점: 글은 안전하게 저장됨
❌ 단점: 이미지를 다시 올려야 함
```

**해결 방법:**
```
임시 방법 (현재):
1. 게시글 수정 기능 사용 (추후 구현)
2. 또는 게시글 삭제하고 다시 작성

근본적 해결:
1. 백엔드 로그 확인
   docker logs spring-backend | tail -50
2. 에러 원인 파악 (위의 문제 1 참고)
3. 문제 해결 후 다시 시도
```

### ❌ 문제 5: Docker가 실행이 안 돼요

#### 증상
```
ERROR: Cannot connect to the Docker daemon
```

**해결 방법:**
```
1. Docker Desktop이 실행 중인지 확인
   - Windows: 작업 표시줄에서 Docker 아이콘 확인
   - Mac: 상단 메뉴바에서 Docker 아이콘 확인

2. Docker Desktop 재시작
   - 완전히 종료
   - 다시 실행
   - "Docker Desktop is running" 표시될 때까지 대기

3. 그래도 안 되면 컴퓨터 재시작
```

#### 증상
```
port 3000 already in use
```

**해결 방법:**
```bash
# 포트 사용 중인 프로세스 찾기
# Windows
netstat -ano | findstr :3000

# Mac/Linux
lsof -i :3000

# 프로세스 종료 후 다시 시도
docker-compose up
```

---

## 자주 묻는 질문

### 💰 요금 관련

#### Q1. AWS 요금이 얼마나 나오나요?

**A:** 거의 무료입니다!

**무료 체험 (첫 12개월):**
- S3 스토리지: 5GB 무료
- GET 요청: 20,000건/월 무료
- PUT 요청: 2,000건/월 무료

**예상 비용 계산:**
```
학생 사용량 예상:
- 월 100개 게시글
- 게시글당 평균 2장 사진
- 사진당 평균 3MB
- 월 1,000회 조회

→ 스토리지: 600MB (무료 범위)
→ 업로드: 200건 (무료 범위)
→ 조회: 2,000건 (무료 범위)

결론: 무료!
```

**무료 기간 이후:**
```
같은 사용량으로 계산:
- 스토리지: 0.6GB × $0.025 = $0.015/월
- 요청 비용: $0.001/월
- 데이터 전송: 약 $0.63/월

총합: 약 $0.65/월 (약 900원)
```

#### Q2. 프로그램을 끄면 요금이 나오나요?

**A:** S3 스토리지 요금만 나옵니다.

```
✅ 무료인 것:
- Docker 실행 안 할 때
- 아무도 접속 안 할 때

💰 요금 나오는 것:
- S3에 파일이 저장되어 있으면
  → 월 단위로 스토리지 요금
  → 1GB = $0.025/월
```

#### Q3. 비용을 줄이려면?

**방법 1: 이미지 압축**
```
업로드 전에 이미지 압축
3MB → 500KB 압축 시
→ 스토리지 비용 84% 절감!
```

**방법 2: 오래된 이미지 삭제**
```
1. 사용 안 하는 게시글 삭제
2. 이미지도 자동으로 삭제됨
3. S3 요금 감소
```

**방법 3: 라이프사이클 정책 (고급)**
```
90일 지난 이미지 자동 삭제 설정
→ AWS 콘솔 → S3 → 관리 → 수명 주기 규칙
```

### 🔒 보안 관련

#### Q4. 내 사진이 다른 사람에게 보이나요?

**A:** 네, URL을 알면 누구나 볼 수 있습니다.

```
🌐 공개 범위:
- 웹사이트에서 로그인 안 해도 이미지 볼 수 있음
- URL을 아는 사람은 누구나 접근 가능

🔒 안전한 부분:
- URL을 모르면 찾을 수 없음
- UUID로 무작위 파일명 (추측 불가능)
- 업로드/삭제는 로그인한 사용자만 가능
```

**비공개 사진을 올리고 싶다면:**
```
❌ 이 기능으로는 안 됨!
→ 개인정보, 민감한 내용은 올리지 마세요

✅ 대안:
- 비밀 게시판 기능 사용 (추후 구현)
- 또는 다른 서비스 이용
```

#### Q5. .env 파일을 실수로 Git에 올렸어요!

**A:** 즉시 조치하세요!

**긴급 조치 (5분 이내):**
```bash
# 1. Git에서 파일 제거
git rm --cached .env
git commit -m "Remove .env file"
git push

# 2. AWS 액세스 키 즉시 비활성화
- AWS 콘솔 → IAM → 사용자
- 기존 액세스 키 "비활성화"

# 3. 새 액세스 키 발급
- 새 액세스 키 생성
- .env 파일 업데이트
- Docker 재시작
```

**예방책:**
```bash
# .gitignore 확인
cat .gitignore | grep .env

# .env가 목록에 없으면 추가
echo ".env" >> .gitignore
git add .gitignore
git commit -m "Add .env to gitignore"
```

### 🛠️ 기능 관련

#### Q6. 이미지를 몇 장까지 올릴 수 있나요?

**A:** 최대 5장입니다.

```
✅ 제한 사항:
- 한 게시글당 최대 5장
- 각 이미지 최대 5MB
- 총 용량 제한: 25MB

💡 더 올리고 싶다면:
1. 게시글을 2개로 나눠서 작성
2. 또는 코드 수정 (개발자용)
```

**코드에서 변경하기 (개발자용):**
```java
// PostImageController.java
if (images.length > 5) {  // 이 숫자를 변경
    return ResponseEntity.badRequest()
        .body("최대 5장까지...");  // 메시지도 변경
}
```

#### Q7. GIF 움짤도 올릴 수 있나요?

**A:** 네, 가능합니다!

```
✅ 지원 형식:
- JPG / JPEG (사진)
- PNG (투명 배경)
- GIF (움직이는 이미지)
- WEBP (최신 형식)

⚠️ 주의:
- GIF는 용량이 큰 경우가 많음
- 5MB 제한 확인하세요
```

#### Q8. 동영상도 올릴 수 있나요?

**A:** 현재는 안 됩니다.

```
❌ 지원 안 됨:
- MP4, AVI, MOV 등 동영상
- 이유: 용량이 너무 크고 처리가 복잡함

✅ 대안:
1. YouTube에 업로드 후 링크 공유
2. 동영상을 GIF로 변환 (짧은 클립)
3. 스크린샷 캡처해서 올리기
```

#### Q9. 업로드한 이미지를 수정할 수 있나요?

**A:** 현재는 삭제만 가능합니다.

```
✅ 가능한 것:
- 게시글 전체 삭제 (이미지도 함께 삭제됨)

❌ 현재 불가능:
- 특정 이미지만 삭제
- 이미지 추가
- 이미지 순서 변경

🔜 추후 구현 예정:
- 게시글 수정 시 이미지도 수정 가능
```

#### Q10. 이미지를 클릭하면 크게 볼 수 있나요?

**A:** 현재는 안 되지만 추후 추가 예정입니다.

```
✅ 현재 상태:
- 게시글 본문 아래 이미지 표시
- 마우스 올리면 살짝 확대

🔜 추가 예정:
- 이미지 클릭 → 전체 화면 모달
- 좌우 화살표로 이미지 넘기기
- 확대/축소 기능
```

### 📱 호환성 관련

#### Q11. 모바일에서도 사용할 수 있나요?

**A:** 네, 반응형으로 작동합니다!

```
✅ 모바일 대응:
- 스마트폰 브라우저에서 접속 가능
- 이미지 업로드 가능
- 갤러리 자동 조정 (1열로 표시)

📱 테스트 방법:
1. 스마트폰에서 http://여러분의IP:3000 접속
2. 또는 브라우저 F12 → 모바일 모드
```

#### Q12. iPhone에서 HEIC 사진을 올릴 수 있나요?

**A:** 직접은 안 되지만 변환하면 됩니다.

```
❌ HEIC 형식:
- iPhone 기본 형식
- 현재 지원 안 됨

✅ 해결 방법:
1. iPhone 설정 변경:
   설정 → 카메라 → 형식 → "호환성 우선" 선택
   → 이후 사진은 JPG로 저장됨

2. 기존 HEIC 변환:
   - 온라인: heictojpg.com
   - 앱: HEIC to JPG Converter

3. 공유할 때:
   사진 선택 → 공유 → "옵션" → "호환 포맷"
```

---

## 🎓 더 배우기

### 개발자를 위한 자료

#### 코드 구조 이해하기

**백엔드 파일 구조:**
```
backend/src/main/java/com/ej2/
├── model/
│   └── PostImage.java              ← 이미지 정보를 담는 클래스
├── repository/
│   └── PostImageRepository.java    ← DB 접근 인터페이스
├── service/
│   ├── S3Service.java              ← S3 업로드/삭제 로직
│   └── PostImageService.java       ← 비즈니스 로직
├── controller/
│   └── PostImageController.java    ← API 엔드포인트
└── config/
    └── S3Config.java                ← AWS 설정
```

**프론트엔드 파일 구조:**
```
frontend/src/pages/Board/
├── PostWritePage.js                 ← 글쓰기 페이지 (업로드)
└── PostDetailPage.js                ← 상세보기 페이지 (표시)
```

#### API 엔드포인트

**1. 이미지 업로드:**
```http
POST /ej2/api/posts/{postId}/images
Content-Type: multipart/form-data

Request:
- images: File[] (최대 5개)

Response: 200 OK
[
  {
    "id": 1,
    "postId": 123,
    "s3Url": "https://...",
    "displayOrder": 0
  }
]
```

**2. 이미지 조회:**
```http
GET /ej2/api/posts/{postId}/images

Response: 200 OK
[
  { "id": 1, "s3Url": "...", ... }
]
```

**3. 이미지 삭제:**
```http
DELETE /ej2/api/posts/{postId}/images/{imageId}

Response: 200 OK
{
  "message": "Image deleted successfully"
}
```

#### 코드 커스터마이징

**최대 이미지 개수 변경:**
```java
// PostImageController.java (22번째 줄)
if (images.length > 5) {  // ← 이 숫자를 변경
```

**파일 크기 제한 변경:**
```javascript
// PostWritePage.js (47번째 줄)
if (file.size > 5 * 1024 * 1024) {  // ← 5를 다른 숫자로
```

**지원 파일 형식 추가:**
```javascript
// PostWritePage.js (53번째 줄)
const validTypes = [
  'image/jpeg',
  'image/jpg',
  'image/png',
  'image/gif',
  'image/webp',
  'image/svg+xml'  // ← SVG 추가 예시
];
```

### 관련 기술 문서

- [AWS S3 공식 문서](https://docs.aws.amazon.com/s3/)
- [Spring Framework 5 문서](https://docs.spring.io/spring-framework/docs/5.3.x/)
- [React 18 문서](https://react.dev/)
- [Docker 문서](https://docs.docker.com/)

---

## 📞 도움말

### 문제가 해결 안 될 때

1. **백엔드 로그 확인**
   ```bash
   docker logs spring-backend | tail -100
   ```

2. **프론트엔드 콘솔 확인**
   ```
   브라우저 F12 → Console 탭
   ```

3. **AWS 상태 확인**
   - 버킷 존재 확인
   - CORS 설정 확인
   - IAM 권한 확인

4. **재시작**
   ```bash
   docker-compose down
   docker-compose up --build
   ```

### 더 자세한 문서

- `AWS_S3_SETUP.md` - AWS 설정 상세 가이드
- `docs/IMAGE_UPLOAD_GUIDE.md` - 기술 문서 (일본어)

---

## ✅ 체크리스트

### 초기 설정 완료 체크

- [ ] AWS 계정 생성
- [ ] S3 버킷 생성 (`ej2-post-images`)
- [ ] CORS 설정 완료
- [ ] 버킷 정책 설정 완료
- [ ] IAM 사용자 생성 (`ej2-s3-uploader`)
- [ ] IAM 정책 연결 (`EJ2-S3-Upload-Policy`)
- [ ] 액세스 키 발급 및 저장
- [ ] `.env` 파일 생성 및 설정
- [ ] Docker Compose 실행 성공
- [ ] 테스트 이미지 업로드 성공

### 문제 발생 시 체크

- [ ] `.env` 파일 존재 및 내용 확인
- [ ] AWS 액세스 키 유효성 확인
- [ ] 버킷 이름 일치 확인
- [ ] CORS 설정 확인
- [ ] 버킷 정책 확인
- [ ] Docker 실행 중 확인
- [ ] 백엔드 로그 확인
- [ ] 브라우저 콘솔 확인

---

**문서 버전:** 1.0
**최종 수정일:** 2026년 2월 10일
**작성자:** EJ2 개발팀

이 문서가 도움이 되셨나요? 질문이나 피드백은 이슈로 남겨주세요!
